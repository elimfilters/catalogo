# ELIMFILTERS API v5.0.0 - ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLIENT REQUESTS                          â”‚
â”‚  (WordPress Plugin, Web Apps, Mobile Apps, External Systems)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ HTTP/HTTPS
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     EXPRESS SERVER (server.js)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Middleware Stack:                                        â”‚ â”‚
â”‚  â”‚  â€¢ CORS                                                   â”‚ â”‚
â”‚  â”‚  â€¢ Body Parser (JSON/URLencoded)                         â”‚ â”‚
â”‚  â”‚  â€¢ Morgan Logger                                         â”‚ â”‚
â”‚  â”‚  â€¢ Request Logging                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚             â”‚             â”‚
           â–¼             â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  /health â”‚  â”‚   /api   â”‚  â”‚    /     â”‚
    â”‚          â”‚  â”‚ /detect  â”‚  â”‚  (root)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  detect  â”‚              â”‚   vin    â”‚
   â”‚  router  â”‚              â”‚  router  â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                         â”‚
        â”‚                         â”‚
        â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVICE LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  detectionServiceFinal.js                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  1. Input Normalization                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  2. Duty Detection (HD/LD)                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  3. Scraper Bridge Execution                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  4. Family Detection                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  5. SKU Generation                                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  6. Media Assignment                                â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  vinService.js                                            â”‚ â”‚
â”‚  â”‚  â””â”€ VIN Decoding & Vehicle Information                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Scraper    â”‚  â”‚     SKU     â”‚  â”‚   Utils     â”‚
â”‚   Bridge    â”‚  â”‚  Generator  â”‚  â”‚  Modules    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â”‚                â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚         â”‚         â”‚                  â”‚
â–¼             â–¼         â–¼         â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HD   â”‚ â”‚  LD  â”‚ â”‚ Rules  â”‚ â”‚Normalize â”‚  â”‚ Family/Duty  â”‚
â”‚(DON)  â”‚ â”‚(FRAM)â”‚ â”‚ Config â”‚ â”‚ Digits   â”‚  â”‚  Detectors   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚         â”‚
    â”‚         â”‚
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   EXTERNAL DATA SOURCES         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Donaldson  â”‚  â”‚    FRAM    â”‚ â”‚
â”‚  â”‚   Website  â”‚  â”‚  Website   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Google Sheets (Optional)  â”‚ â”‚
â”‚  â”‚  â€¢ Master Catalog Cache    â”‚ â”‚
â”‚  â”‚  â€¢ Cross References        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DATA FLOW EXAMPLE - FILTER DETECTION:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. REQUEST
   GET /api/detect/P552100
   
2. NORMALIZATION
   "P552100" â†’ "P552100" (already clean)
   
3. DUTY DETECTION
   Check OEM prefix â†’ Detected: "HD" (Heavy Duty)
   
4. SCRAPER SELECTION
   HD â†’ Route to Donaldson Scraper
   
5. SCRAPING
   Donaldson.com â†’ Extract:
   â€¢ Code: P552100
   â€¢ Family hint: "Oil Filter"
   â€¢ Cross references
   â€¢ Applications
   â€¢ Attributes
   
6. FAMILY DETECTION
   "Oil Filter" + HD â†’ Family: "OIL"
   
7. DIGIT EXTRACTION
   P552100 â†’ Extract last 4 digits â†’ "2100"
   
8. SKU GENERATION
   Lookup: OIL|HD â†’ Prefix: "EL8"
   SKU = "EL8" + "2100" = "EL82100"
   
9. MEDIA ASSIGNMENT
   Family "OIL" â†’ Media: "ELIMTEKâ„¢ EXTENDED 99%"
   
10. RESPONSE
    {
      "success": true,
      "status": "OK",
      "duty": "HD",
      "family": "OIL",
      "sku": "EL82100",
      "media": "ELIMTEKâ„¢ EXTENDED 99%",
      "source": "DONALDSON",
      "oem_equivalent": "P552100",
      "last4": "2100",
      ...
    }


FOLDER STRUCTURE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

elimfilters-api/
â”‚
â”œâ”€â”€ ğŸ“„ Entry Point
â”‚   â””â”€â”€ server.js                 # Express app initialization
â”‚
â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ api/                   # REST API Layer
â”‚   â”‚   â”œâ”€â”€ detect.js            # Filter detection routes
â”‚   â”‚   â””â”€â”€ vin.js               # VIN decoding routes
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ services/              # Business Logic Layer
â”‚   â”‚   â”œâ”€â”€ detectionServiceFinal.js   # Main detection orchestrator
â”‚   â”‚   â””â”€â”€ vinService.js              # VIN processing
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ scrapers/              # Data Acquisition Layer
â”‚   â”‚   â”œâ”€â”€ scraperBridge.js     # Scraper router (HD/LD)
â”‚   â”‚   â”œâ”€â”€ donaldson.js         # Donaldson website scraper
â”‚   â”‚   â””â”€â”€ fram.js              # FRAM website scraper
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ sku/                   # SKU Generation
â”‚   â”‚   â””â”€â”€ generator.js         # SKU rules & generation
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ utils/                 # Utility Functions
â”‚   â”‚   â”œâ”€â”€ normalize.js         # Text normalization
â”‚   â”‚   â”œâ”€â”€ digitExtractor.js    # Digit extraction
â”‚   â”‚   â”œâ”€â”€ mediaMapper.js       # Filter media mapping
â”‚   â”‚   â”œâ”€â”€ dutyDetector.js      # HD/LD detection
â”‚   â”‚   â”œâ”€â”€ familyDetector.js    # Family classification
â”‚   â”‚   â””â”€â”€ messages.js          # Response messages
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ config/                # Configuration
â”‚       â””â”€â”€ skuRules.json        # SKU prefix rules
â”‚
â”œâ”€â”€ ğŸ“„ Deployment
â”‚   â”œâ”€â”€ Dockerfile               # Container definition
â”‚   â”œâ”€â”€ railway.json             # Railway config
â”‚   â”œâ”€â”€ .env.example             # Environment template
â”‚   â””â”€â”€ .gitignore               # Git ignore rules
â”‚
â”œâ”€â”€ ğŸ“„ Dependencies
â”‚   â””â”€â”€ package.json             # NPM dependencies
â”‚
â””â”€â”€ ğŸ“„ Documentation
    â”œâ”€â”€ README.md                # Project overview
    â”œâ”€â”€ DEPLOYMENT.md            # Deployment guide
    â”œâ”€â”€ MIGRATION.md             # Migration guide
    â””â”€â”€ QUICK-START.md           # Quick start guide


TECHNOLOGY STACK:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Backend Framework:  Express.js 4.18.2
Runtime:            Node.js 20+
HTTP Client:        Axios 1.6.8
HTML Parser:        Cheerio 1.0.0-rc.12
Logger:             Morgan 1.10.0
Cache:              Node-Cache 5.1.2

Optional Integrations:
- Google Sheets:    googleapis 128.0.0
- MongoDB:          mongoose 8.3.1 (for future use)

Deployment:
- Containerization: Docker (Alpine Linux)
- PaaS:            Railway
- CI/CD:           GitHub (via Railway auto-deploy)


DEPLOYMENT TARGETS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Railway (Recommended)
   â€¢ Auto-deploy on git push
   â€¢ Built-in health checks
   â€¢ Environment management
   â€¢ Logs & metrics
   â€¢ Custom domains
   
âœ… Docker / Docker Compose
   â€¢ Portable containers
   â€¢ Local development
   â€¢ Self-hosted options
   
âœ… Cloud Providers
   â€¢ AWS (ECS, Elastic Beanstalk)
   â€¢ Google Cloud (Cloud Run)
   â€¢ Azure (Container Apps)
   â€¢ DigitalOcean (App Platform)


SCALABILITY NOTES:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Current Architecture:
- Stateless API (scales horizontally)
- In-memory caching (single instance)
- External scraping (I/O bound)

Future Improvements:
1. Redis for distributed caching
2. MongoDB for persistent storage
3. Queue system for heavy scraping (Bull/RabbitMQ)
4. Load balancing (multiple instances)
5. CDN for static content
6. Rate limiting per client
```
